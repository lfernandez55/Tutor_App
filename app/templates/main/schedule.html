{% extends "main/main_base.html" %} {# main/main_base.html extends layout.html #}

{% block title %}{{app_name}}{% endblock %}

{% block navbar %}overriding the nav bar...
{% endblock %}
{% block body %}

{% block page_content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">

<link rel="stylesheet" href="/static/css/schedule_style.css">
<script src="/static/js/schedule.js"></script>

<h1>Schedule Page</h1>
<button onclick="baz()">Baz test</button>

<div class="schedule" aria-labelledby="schedule-heading">

    <span class="track-slot" aria-hidden="true"
        style="grid-column: mon-1-start / mon-2-end;; grid-row: tracks;">Monday</span>
    <span class="track-slot" aria-hidden="true"
        style="grid-column: tue-1-start / tue-2-end; grid-row: tracks;">Tuesday</span>
    <span class="track-slot" aria-hidden="true"
        style="grid-column: wed-1-start / wed-2-end; grid-row: tracks;">Wednesday</span>
    <span class="track-slot" aria-hidden="true"
        style="grid-column: thu-1-start / thu-2-end; grid-row: tracks;">Thursday</span>
    <span class="track-slot" aria-hidden="true"
        style="grid-column: fri-1-start / fri-2-end; grid-row: tracks;">Friday</span>



    <h2 class="time-slot" style="grid-row: time-0800;">8:00am</h2>
    <h2 class="time-slot" style="grid-row: time-0830;">8:30am</h2>
    <h2 class="time-slot" style="grid-row: time-0900;">9:00am</h2>
    <h2 class="time-slot" style="grid-row: time-0930;">9:30am</h2>
    <h2 class="time-slot" style="grid-row: time-1000;">10:00am</h2>
    <h2 class="time-slot" style="grid-row: time-1030;">10:30am</h2>
    <h2 class="time-slot" style="grid-row: time-1100;">11:00am</h2>
    <h2 class="time-slot" style="grid-row: time-1130;">11:30am</h2>
    <h2 class="time-slot" style="grid-row: time-1200;">12:00pm</h2>
    <h2 class="time-slot" style="grid-row: time-1230;">12:30pm</h2>
    <h2 class="time-slot" style="grid-row: time-1200;">12:00pm</h2>
    <h2 class="time-slot" style="grid-row: time-1230;">12:30pm</h2>
    <h2 class="time-slot" style="grid-row: time-1300;">1:00pm</h2>
    <h2 class="time-slot" style="grid-row: time-1330;">1:30pm</h2>
    <h2 class="time-slot" style="grid-row: time-1400;">2:00pm</h2>
    <h2 class="time-slot" style="grid-row: time-1430;">2:30pm</h2>
    <h2 class="time-slot" style="grid-row: time-1500;">3:00pm</h2>
    <h2 class="time-slot" style="grid-row: time-1530;">3:30pm</h2>
    <h2 class="time-slot" style="grid-row: time-1600;">4:00pm</h2>
    <h2 class="time-slot" style="grid-row: time-1630;">4:30pm</h2>
    <h2 class="time-slot" style="grid-row: time-1700;">5:00pm</h2>


    <!-- <h2 class="day">Monday</h2>


    <div class="session tutor-1" style="grid-column: mon-1-start / mon-1-end; grid-row: time-0800 / time-0900;">
        <h3 class="session-lead"><a href="#">Brendan K.</a></h3>
        <span class="session-time">8:00 - 9:00</span>
    </div>

    <div class="session tutor-3" style="grid-column: mon-2-start / mon-2-end; grid-row: time-0800 / time-0845;">
        <h3 class="session-lead"><a href="#">Joseph H.</a></h3>
        <span class="session-time">8:00 - 8:45</span>
    </div>

    <div class="session  tutor-2" style="grid-column: mon-1-start / mon-2-end; grid-row: time-0900 / time-1000;">
        <h3 class="session-lead"><a href="#">Luke F.</a></h3>
        <span class="session-time">9:00 - 10:00</span>
    </div>

    <div class="session  tutor-4" style="grid-column: mon-1-start / mon-2-end; grid-row: time-1000 / time-1100;">
        <h3 class="session-lead"><a href="#">Ron T</a></h3>
        <span class="session-time">10:00 - 11:00</span>
    </div>

    <div class="session  tutor-4" style="grid-column: mon-1-start / mon-2-end; grid-row: time-1500 / time-1715;">
        <h3 class="session-lead"><a href="#">Ron T</a></h3>
        <span class="session-time">15:00 - 17:15</span>
    </div>




    <h2 class="day">Tuesday</h2>

    <div class="session  tutor-3" style="grid-column: tue-1-start / tue-1-end; grid-row: time-0800 / time-0830;">
        <h3 class="session-lead"><a href="#">Joseph H.</a></h3>
        <span class="session-time">8:00 - 8:30</span>
    </div>



    <div class="session tutor-4" style="grid-column: tue-2-start / tue-2-end; grid-row: time-0800 / time-0830;">
        <h3 class="session-lead"><a href="#">Ron T.</a></h3>
        <span class="session-time">8:00 - 8:30</span>
    </div>




    <h2 class="day">Wednesday</h2>




    <h2 class="day">Thursday</h2>
    <div class="session tutor-2" style="grid-column: thu-1-start / thu-1-end; grid-row: time-0800 / time-0930;">
        <h3 class="session-lead"><a href="#">Luke F.</a></h3>
        <span class="session-time">11:00 - 12:00</span>
    </div>



    <h2 class="day">Friday</h2>


    <div class="session tutor-5" style="grid-column: fri-1-start / fri-2-end; grid-row: time-0800 / time-1000;">
        <h3 class="session-lead"><a href="#">Sally G.</a></h3>
        <span class="session-time">8:00 - 10:00</span>
    </div>
    
    
    <div class="session tutor-6" style="grid-column: fri-1-start / fri-2-end; grid-row: time-1230 / time-1400;">
        <h3 class="session-lead"><a href="#">Suzie Q.</a></h3>
        <span class="session-time">8:30 - 10:00</span>
    </div> -->

    <!-- <div class="session tutor-1" style="grid-column:  mon-1-start / mon-1-end;grid-row: time-09:00 / time-10:00;"><h3 class="session-lead"><a href="#">undefined </a></h3><span class="session-time">09:00:00-09:00:00</span></div>
     -->

 

        <div class="session tutor-1" style="grid-column:  mon-1-start / mon-2-end;grid-row: time-1130 / time-1330;">
            <h3 class="session-lead"><a href="#">Susan </a></h3><span class="session-time">11:30:00-13:30:00</span>
        </div>
        <div class="session tutor-1" style="grid-column:  wed-1-start / wed-2-end;grid-row: time-0800 / time-0900;">
            <h3 class="session-lead"><a href="#">Susan </a></h3><span class="session-time">08:00:00-09:00:00</span>
        </div>
 







</div>




<button onclick="getSched()">Test request</button>
<script>
    function getSched() {
        var tutorId = 1;
        var urlVar = '/schedule_json?tutor_id=' + tutorId;
        var request = new Request(urlVar, {
            method: 'GET'
        });
        fetch(request)
            .then((response) => {
                //return (response.text())
                return response.json();
            })
            .then((resp) => {
                alert(resp)
                populateSched(resp)
                // glob = resp;
            })
            .catch((err) => {
                alert('Error: ' + err.message);
            });
    }
    // var glob;
    // function calculateSlotAlignment(slotArray = glob) {
    function calculateSlotAlignment(slotArray) {
        console.log(slotArray)
        var foo = slotArray.filter(addAlignmentAttr);
        console.log('dddddd', slotArray);
        for (let x = 0; x < slotArray.length; x++) {
            for (let y = 0; y < slotArray.length; y++) {
                if (slotArray[x].id != slotArray[y].id){
                    if (slotArray[x].day == slotArray[y].day){
                        if ((parseTime(slotArray[x].time_start) < parseTime(slotArray[y].time_end)) && (parseTime(slotArray[x].time_end) > parseTime(slotArray[y].time_start)) ) {
                            console.log("id", slotArray[x].id, slotArray[y].id, 'xy', x, y, slotArray[x].time_start, slotArray[x].time_end,"|",)
                            if (slotArray[y].alignment == 'left'){
                                slotArray[x].alignment = 'right';
                                console.log('left')
                            } else{
                                slotArray[x].alignment = 'left';
                                console.log('right')
                            }
                        }
                    }
                }


            }


        }
        console.log(slotArray)
    }
    function parseTime(time){
        time = parseInt(time.replace(/:/g,""));
        time = time / 100;
        return time;
    }
    // alert(parseTime('10:00:00'))
    function addAlignmentAttr(obj){
        obj.alignment = 'span';
        return obj;
    }

    function populateSched(slotArray){
        calculateSlotAlignment(slotArray);

        for (let x = 0; x < slotArray.length; x++) {
            var divVar = document.createElement('div');
            divVar.setAttribute('class', 'session tutor-1');
            divVar.setAttribute('style', createStyle(slotArray[x]))

            divVar.innerHTML = '<h3 class="session-lead"><a href="#">' + slotArray[x].tutor_first_name + ' </a></h3><span class="session-time">' + slotArray[x].time_start  + "-" + slotArray[x].time_end  +  '</span>';
            // alert(divVar)
            document.getElementById('slots').appendChild(divVar);
        }

    }

    function createStyle(slot){
        var styleStr = "grid-column: " + " " + dayOfWeek[slot.day] + "-" + coordLeft[slot.alignment] + " / " + dayOfWeek[slot.day] + "-" + coordRight[slot.alignment] + ";"
        styleStr = styleStr + "grid-row: time-" + trimEnd(slot.time_start) + " / time-" + trimEnd(slot.time_end) + ";"  
        return styleStr;
    }
    var dayOfWeek = {
        1: 'mon',
        2: 'tue',
        3: 'wed',
        4: 'thu',
        5: 'fri'
    }
    var coordLeft = {
        span: "1-start",
        left: "1-start",
        right: "2-start"
    }
    var coordRight = {
        span: "2-end",
        left: "1-end",
        right: "2-end"
    }
    function trimEnd(timeStr){
        timeStr = timeStr.slice(0, -3);
        timeStr = timeStr.replace(/:/g,"")
        return timeStr
    }
</script>
    <button onclick="calculateSlotAlignment()">calculateSlotAlignment</button>
{% endblock %}
{% endblock %}